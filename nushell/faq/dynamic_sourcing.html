<!DOCTYPE HTML><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style id="nojscss">.jsonly{display:none;}</style><style id="fcss"></style><link rel="stylesheet" type="text/css" href="style.css"><meta name="author" content="Jan9103"><script>function ch(btn){btn.classList.toggle("active");btn.parentElement.nextElementSibling.classList.toggle("hidelvl");btn.innerText=btn.innerText=="-"?"+":"-";}document.getElementById("nojscss").innerText=".hidelvl{display:none;}";</script><title>Dynamic sourcing</title></head><body><div class="container"><h1>Dynamic sourcing</h1> <h2>Understanding the problem <button onclick="ch(this)">-</button></h2><div><p>In nushell the target file of  <b>source</b>  and  <b>use</b>  have to be constant.</p> <p>Additionally a imported file has to exist before the script/config/.. is loaded.</p> <p>This breaks a lot of the intuitive options.</p></div> <h2>Method1: if else <button onclick="ch(this)" class="active">+</button></h2><div class="hidelvl"><p>Yes the target has to be constant, but a lot of things can be constant. This includes</p> <div class="cb"><pre><span class="a_36">source</span> <span class="a_34">(</span><span class="a_36">if</span> <span class="a_35">$nu</span>.<span class="a_32">os-info</span>.<span class="a_32">name</span> <span class="a_33">==</span> <span class="a_32">&quot;windows&quot;</span> <span class="a_34">{</span><span class="a_32">&quot;windows.nu&quot;</span><span class="a_34">}</span> <span class="a_36">else</span> <span class="a_34">{</span><span class="a_32">&quot;linux.nu&quot;</span><span class="a_34">}</span><span class="a_34">)</span></pre></div> and (credit to bahex for this one) <div class="cb"><pre><span class="a_36">module</span> <span class="a_32">unix</span> <span class="a_34">{
  </span><span class="a_36">export def</span> <span class="a_32">hello</span> <span class="a_32">[]</span> <span class="a_32">{ </span><span class="a_32">&quot;hello unix&quot;</span><span class="a_32"> }</span><span class="a_34">
}</span>
<span class="a_36">module</span> <span class="a_32">windows</span> <span class="a_34">{
  </span><span class="a_36">export def</span> <span class="a_32">hello</span> <span class="a_32">[]</span> <span class="a_32">{ </span><span class="a_32">&quot;hello windows&quot;</span><span class="a_32"> }</span><span class="a_34">
}</span>

<span class="a_36">use</span> <span class="a_34">(</span><span class="a_36">if</span> <span class="a_35">$nu</span>.<span class="a_32">os-info</span>.<span class="a_32">family</span> <span class="a_33">==</span> <span class="a_32">&quot;unix&quot;</span> <span class="a_34">{ </span><span class="a_32">&quot;unix&quot;</span><span class="a_34"> }</span> <span class="a_36">else</span> <span class="a_34">{ </span><span class="a_32">&quot;windows&quot;</span><span class="a_34"> }</span><span class="a_34">)</span> <span class="a_32">*</span>
<span class="a_36">hello</span></pre></div></div> <h2>Method2: autoload dirs <button onclick="ch(this)" class="active">+</button></h2><div class="hidelvl"><p>The variables  <b>$nu.user-autoload-dirs</b>  and  <b>$nu.vendor-autoload-dirs</b>  contain a list of directories from which all scripts will be sourced on startup.</p> <p>Thus you can just put things in there or not depending on your device.</p> <a href="https://www.nushell.sh/book/configuration.html#startup-variables">More information</a></div> <h2>Method3: (nu config only) config.nu + env.nu <button onclick="ch(this)" class="active">+</button></h2><div class="hidelvl"><div class="notice_box"><b>Notice:</b> There has been a discussion to remove env.nu for quite a while. So this method might break at some point.</div> <p>A file has to exist when a script is loaded, but noone said it has to be loaded on shell start.</p> <p><b>env.nu</b>  is loaded before  <b>config.nu</b>  and thus it is possible to generate a script  in  <b>env.nu</b>  and then later load it in  <b>config.nu</b> .</p> <p>Example:</p> <b>env.nu</b> : <div class="cb"><pre><span class="a_36">[
  </span><span class="a_34">(</span><span class="a_36">if</span> <span class="a_35">$nu</span>.<span class="a_32">os-info</span>.<span class="a_32">family</span> <span class="a_33">==</span> <span class="a_32">&quot;unix&quot;</span> <span class="a_34">{ </span><span class="a_32">&quot;source foo.nu&quot;</span><span class="a_34"> }</span> <span class="a_36">else</span> <span class="a_34">{ </span><span class="a_32">&quot;source bar.nu&quot;</span><span class="a_34"> }</span><span class="a_34">)</span>
  <span class="a_34">(</span><span class="a_36">if</span> <span class="a_35">$env</span>.<span class="a_32">USER</span> <span class="a_33">==</span> <span class="a_32">&quot;bob&quot;</span> <span class="a_34">{ </span><span class="a_32">&quot;source bob.nu&quot;</span><span class="a_34"> }</span> <span class="a_36">else</span> <span class="a_34">{ </span><span class="a_32">&quot;&quot;</span><span class="a_34"> }</span><span class="a_34">)</span><span class="a_36">
]</span> <span class="a_35">|</span> <span class="a_36">str join</span> <span class="a_32">&quot;\n&quot;</span> <span class="a_35">|</span> <span class="a_36">save</span> <span class="a_34">-rf</span> <span class="a_36">&quot;dynamic_loader.nu&quot;</span></pre></div> <b>config.nu</b> : <div class="cb"><pre><span class="a_36">source</span> <span class="a_36">dynamic_loader.nu</span></pre></div></div> <h2>Method4: package managers <button onclick="ch(this)" class="active">+</button></h2><div class="hidelvl"><p>Some package managers allow dynamic configurations, but you can also just keep a seperate  package list for each of your devices.</p> <p>Yes this means you have to maintain something on a 'per-device' basis, but a package-list  is a lot easier in my eyes.</p> <a href="./package_management.html">More information</a></div></div><footer><b>Credits:</b><ul><li>Code color scheme: <a href="https://draculatheme.com/">dracula</a></li></ul></footer></body></html>